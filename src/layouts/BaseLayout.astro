---
import "@/styles/global.css";
import Footer from "@/components/Footer.astro";
import Header from "@/components/Header.astro";

const {
  title = "Luminarte Projects",
  description = "",
  noindex = false,
  ogImage = "",
  headerCompact = false,
  mainClass = "",
  canonicalUrl = "",
  preconnectOrigins = [],
  ogType = "website",
} = Astro.props;

const pageUrl = Astro.url?.toString?.() ?? "";
const canonical = canonicalUrl || pageUrl || "";
const siteName = "LuminArte";
const locale = "es_MX";
const themeColor = "#1d1d1d";
const normalizedOgImage = (() => {
  if (!ogImage || typeof ogImage !== "string") return "";
  if (ogImage.startsWith("http")) return ogImage;
  try {
    return new URL(ogImage, Astro.url).toString();
  } catch {
    return ogImage;
  }
})();
const normalizedOgImageType = (() => {
  if (!normalizedOgImage) return "";
  if (normalizedOgImage.endsWith(".png")) return "image/png";
  if (normalizedOgImage.endsWith(".jpg") || normalizedOgImage.endsWith(".jpeg")) return "image/jpeg";
  if (normalizedOgImage.endsWith(".webp")) return "image/webp";
  return "";
})();
const normalizedPreconnectOrigins = Array.from(
  new Set(
    (Array.isArray(preconnectOrigins) ? preconnectOrigins : [])
      .filter((origin: unknown): origin is string => typeof origin === "string" && origin.length > 0)
      .map((origin) => {
        try {
          return new URL(origin).origin;
        } catch {
          return "";
        }
      })
      .filter(Boolean),
  ),
);
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <meta name="theme-color" content={themeColor} />
    <meta name="color-scheme" content="dark" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <title>{title}</title>
    {description && <meta name="description" content={description} />}
    {canonical && <link rel="canonical" href={canonical} />}
    {noindex && <meta name="robots" content="noindex, nofollow, noarchive" />}
    {noindex && <meta name="googlebot" content="noindex, nofollow, noarchive" />}
    {noindex && <meta name="bingbot" content="noindex, nofollow, noarchive" />}
    <meta property="og:title" content={title} />
    {description && <meta property="og:description" content={description} />}
    <meta property="og:type" content={ogType} />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:locale" content={locale} />
    {canonical && <meta property="og:url" content={canonical} />}
    {normalizedOgImage && <meta property="og:image" content={normalizedOgImage} />}
    {normalizedOgImage && <meta property="og:image:secure_url" content={normalizedOgImage} />}
    {normalizedOgImageType && <meta property="og:image:type" content={normalizedOgImageType} />}
    <meta name="twitter:card" content={normalizedOgImage ? "summary_large_image" : "summary"} />
    <meta name="twitter:title" content={title} />
    {description && <meta name="twitter:description" content={description} />}
    {normalizedOgImage && <meta name="twitter:image" content={normalizedOgImage} />}

    {
      normalizedPreconnectOrigins.map((origin) => (
        <>
          <link rel="dns-prefetch" href={origin} />
          <link rel="preconnect" href={origin} crossorigin />
        </>
      ))
    }

    <!-- <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script> -->
    <script type="module" src="/vendor/model-viewer.min.js"></script>
  </head>
  <body class="min-w-80">
    <Header compact={headerCompact} />
    <main class:list={["text-white w-full justify-center", mainClass || "mx-5 my-4"]}>
      <slot />
    </main>
    <Footer full={false} />
  </body>
</html>
