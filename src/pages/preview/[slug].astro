---
import BaseLayout from "@layouts/BaseLayout.astro";
import ModelViewer from "@components/ModelViewer.astro";
import {
  getProjectBySlug,
  getMediaUrl,
  getMediaUrlsFromGallery,
} from "@lib/content";

const { slug } = Astro.params;
if (!slug) return new Response("Not found", { status: 404 });

const project = await getProjectBySlug(slug);
if (!project) return new Response("Not found", { status: 404 });

const title = project.name ?? `Preview: ${project.slug}`;
const description = project.description ?? "";

const glbUrl = getMediaUrl(project.model);
const imageUrls = getMediaUrlsFromGallery(project.images);

Astro.response.headers.set(
  "Cache-Control",
  "public, max-age=0, s-maxage=120, stale-while-revalidate=300",
);
---

<BaseLayout title={title} description={description} noindex>
  <section class="mx-auto px-4">
    <h1 class="text-2xl text-center font-bold drop-shadow-md">
      {title}
    </h1>

    <div class="mx-auto">
      <div>
        {
          glbUrl ? (
            <ModelViewer url={glbUrl} name={title} isInteractive={true} />
          ) : (
            <div class="flex h-130 items-center justify-center opacity-70">
              No hay modelo (campo <code>model</code>).
            </div>
          )
        }
      </div>

      {
        imageUrls.length ? (
          <div class="mt-3">
            {imageUrls.map((u: string) => (
              <a
                href={u}
                target="_blank"
                class="block overflow-hidden rounded-xl border border-white/10"
              >
                <img
                  src={u}
                  alt=""
                  loading="lazy"
                  class="h-40 w-full object-cover"
                />
              </a>
            ))}
          </div>
        ) : (
          ""
        )
      }
    </div>
  </section>
</BaseLayout>
